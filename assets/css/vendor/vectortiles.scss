/*
 * VECTORTILES.SCSS - SVG Pattern Generation Library
 * =================================================
 *
 * LINES MIXIN - Master pattern generator for line-based SVG backgrounds
 *
 * SINGLE LAYER USAGE:
 * @include lines($thickness, $size, $color, $angle, $svg-size);
 *
 * Parameters (in order):
 * - $thickness: Line thickness as percentage of pattern size (e.g., 10%, 50%, 90%)
 * - $size: Pattern repeat size in pixels (e.g., 20px, 36px, 100px)
 * - $color: Any CSS color format (see Color Support below)
 * - $angle: Rotation angle with units (e.g., 0deg, 45deg, 90deg, 135deg)
 * - $svg-size: [OPTIONAL] SVG canvas size for bleed control (default: 500px)
 *
 * MULTI-LAYER USAGE:
 * $layer1: ($thickness, $size, $color, $angle);
 * $layer2: ($thickness, $size, $color, $angle);
 * @include lines($layer1, $layer2, $layer3...);
 *
 * COLOR SUPPORT:
 * - All color inputs (hex, named colors, rgb, rgba, anything you throw at it)
 * PS:  Transparent/alpha values work perfectly for layer blending
 *
 * BLEED CONTROL:
 * If patterns show edge artifacts, increase the secret 5th parameter:
 * @include lines(10%, 36px, red, 45deg, 800px); // Larger SVG canvas
 *
 * COMMON PATTERNS:
 * - Horizontal lines: @include lines(10%, 30px, #666, 0deg);
 * - Diagonal stripes: @include lines(50%, 20px, blue, 45deg);
 * - Grid pattern: Use multi-layer with 0deg + 90deg angles
 * - Tartan plaid: Use multi-layer with 45deg + 90deg + 135deg angles
 * - Cross/Plus: Use multi-layer with matching angles 90deg apart
 *
 * EXAMPLES:
 * Simple stripe: @include lines(15%, 24px, #ff8c00, 30deg);
 * Grid: @include lines((8%, 30px, green, 0deg), (8%, 30px, green, 90deg));
 * Tartan: @include lines((5%, 40px, red, 45deg), (5%, 40px, blue, 90deg), (5%, 40px, yellow, 135deg));
 */

// Função para converter qualquer cor para formato data URL (versão simplificada)
@function color-to-data-url($color) {
    // Converte tudo para string e substitui # por %23 se necessário
    $color-string: "#{$color}";

    // Se é hex, substitui # por %23
    @if str-index($color-string, "#") == 1 {
        @return "%23" + str-slice($color-string, 2);
    }

    // Para rgba/rgb, retorna como está (navegadores modernos suportam)
    @return $color-string;
}



// DOTS MIXIN - padrão simples usando radial-gradient (sem SVG por ora)
// Uso: @include dots($density, $size, $color, $spacing);
// $density atualmente ignorado (hook futuro para ajustar $spacing dinamicamente)
@mixin dots($density, $size, $color, $spacing) {
    background-image: radial-gradient(circle, #{$color} #{$size}, transparent #{$size});
    background-size: $spacing $spacing;
    background-repeat: repeat;
}

// Exemplo:
// @include dots(20%, 16px, #666, 32px);

@mixin lines($args...) {
    // Verifica se o primeiro argumento é uma lista (layer) ou valor simples
    $first-arg: nth($args, 1);
    $is-multi-layer: false;

    // Se o primeiro argumento é uma lista de 4+ elementos, é multi-layer
    @if type-of($first-arg) == list and length($first-arg) >= 4 {
        $is-multi-layer: true;
    }

    @if $is-multi-layer {
        // Multi-layer mode
        $background-images: ();
        $background-sizes: ();
        $background-positions: ();
        $counter: 1;

        @each $layer in $args {
            $thickness: nth($layer, 1);
            $size: nth($layer, 2);
            $color: nth($layer, 3);
            $angle: nth($layer, 4);
            $svg-size: if(length($layer) > 4, nth($layer, 5), 500px);

            $svg-color: color-to-data-url($color);
            $height: $size * $thickness / 100%;
            $angle-value: if($angle == 0deg, 0, str-slice(#{$angle}, 1, str-length(#{$angle}) - 3));
            $svg-size-value: if($svg-size == 500px, 500, str-slice(#{$svg-size}, 1, str-length(#{$svg-size}) - 2));
            $center: $svg-size-value / 2;

            $pattern-id: 'lines-pattern-#{$counter}';
            $svg: url("data:image/svg+xml,%3Csvg width='#{$svg-size-value}' height='#{$svg-size-value}' viewBox='0 0 #{$svg-size-value} #{$svg-size-value}' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='#{$pattern-id}' width='#{$size}' height='#{$size}' patternUnits='userSpaceOnUse'%3E%3Crect width='#{$size}' height='#{$height}' fill='#{$svg-color}'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23#{$pattern-id})' transform='rotate(#{$angle-value} #{$center} #{$center})'/%3E%3C/svg%3E");

            $background-images: append($background-images, $svg, comma);
            $background-sizes: append($background-sizes, $svg-size $svg-size, comma);
            $background-positions: append($background-positions, center center, comma);

            $counter: $counter + 1;
        }        // Usa propriedades separadas que funcionam
        background-image: $background-images;
        background-size: $background-sizes;
        background-position: $background-positions;
    }
    @else {
        // Single layer mode - argumentos simples
        $thickness: if(length($args) > 0, nth($args, 1), 10%);
        $size: if(length($args) > 1, nth($args, 2), 36px);
        $color: if(length($args) > 2, nth($args, 3), #ff8c00);
        $angle: if(length($args) > 3, nth($args, 4), 0deg);
        $svg-size: if(length($args) > 4, nth($args, 5), 500px);

        $svg-color: color-to-data-url($color);
        $height: $size * $thickness / 100%;
        $angle-value: if($angle == 0deg, 0, str-slice(#{$angle}, 1, str-length(#{$angle}) - 3));
        $svg-size-value: if($svg-size == 500px, 500, str-slice(#{$svg-size}, 1, str-length(#{$svg-size}) - 2));
        $center: $svg-size_value / 2;

        background-image: url("data:image/svg+xml,%3Csvg width='#{$svg-size-value}' height='#{$svg-size-value}' viewBox='0 0 #{$svg-size-value} #{$svg-size-value}' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='lines-pattern' width='#{$size}' height='#{$size}' patternUnits='userSpaceOnUse'%3E%3Crect width='#{$size}' height='#{$height}' fill='#{$svg-color}'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23lines-pattern)' transform='rotate(#{$angle-value} #{$center} #{$center})'/%3E%3C/svg%3E");
        background-size: $svg-size $svg-size;
        background-position: center center;
    }
}
