<head>
  {{/*
    Cover image selection logic (Open Graph and RSS):
    Priority order:
    1. If frontmatter has "cover", use /images/covers/COVER.jpg
    2. If /images/covers/SLUG.jpg exists, use it
    3. If post is in /content/illustrations/ and illos list exists, use first illo: /images/illos/FIRST.jpg or /images/illos/FIRST.png (checks both)
    4. Otherwise, use /images/covers/live.jpg

    This ensures every post gets a sensible default cover for social and RSS, with easy customization via frontmatter or slug-based images.
  */}}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

  <!-- iOS webapp meta tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Color scheme and theme color -->
  <meta name="color-scheme" content="{{ default "dark light" .Params.colorScheme }}" />
  <meta name="theme-color" content="{{ default "#000000" .Params.themeColor }}" />

  <title>{{ .Page.Title }}</title>
  <meta content="{{ default .Site.Params.author .Params.author }}" name="author" />
  <!-- Dynamically included fonts -->
  {{ with .Params.fonts }}
    {{ range . }}
      <link rel="preload" as="font" href="{{ printf "/fonts/%s.woff2" . }}" type="font/woff2" crossorigin>
      <style>
        @font-face {
          font-family: '{{ . }}';
          src: url('{{ printf "/fonts/%s.woff2" . }}') format('woff2');
          font-weight: 400;
          font-style: normal;
          font-display: swap;
        }
      </style>
    {{ end }}
  {{ end }}

  {{ $options := dict "outputStyle" "compressed" "enableSourceMap" true }}
  {{ $style := resources.Get "css/main.scss" | css.Sass $options | fingerprint }}
  <link rel="stylesheet" href="{{ $style.RelPermalink }}" />

  <!--
    This block includes CSS files listed in the page's front matter 'style' or 'css' parameter.
    For example, if style: ["AAA", "BBB"] is set, it will include css/AAA.css and css/BBB.css.
    Additionally, if the post is named BLURB and css/BLURB.css exists, it will be included.
  -->


  {{ $base := .File.BaseFileName }}
  {{ $cssPath := printf "static/css/%s.css" $base }}
  {{ $cssHref := printf "css/%s.css" $base | relURL }}
  {{ if fileExists $cssPath }}
    <link href="{{ $cssHref }}" rel="stylesheet" />
  {{ end }}

  {{ with .Params.style }}
      {{ range . }}
        {{ $cssMin := printf "css/%s.min.css" . }}
        {{ $css := printf "css/%s.css" . }}
        {{ if (fileExists (printf "static/%s" $cssMin)) }}
          <link href="{{ $cssMin | relURL }}" rel="stylesheet" />
        {{ else if (fileExists (printf "static/%s" $css)) }}
          <link href="{{ $css | relURL }}" rel="stylesheet" />
        {{ end }}
      {{ end }}
  {{ end }}

    <!-- Slug-based CSS loading logic (mirroring load-js.html, but for CSS):
         - Check if a CSS file matching the post slug exists in /css/:
           - If "css/SLUG.min.css" exists, include it.
           - If not, check for "css/SLUG.css".
           - If neither exists, skip. Prefer minified if both. -->
    {{ $slug := .File.BaseFileName }}
    {{ $slugCssMin := printf "css/%s.min.css" $slug }}
    {{ $slugCss := printf "css/%s.css" $slug }}
    {{ if (fileExists (printf "static/%s" $slugCssMin)) }}
      <link href="{{ $slugCssMin | relURL }}" rel="stylesheet" />
    {{ else if (fileExists (printf "static/%s" $slugCss)) }}
      <link href="{{ $slugCss | relURL }}" rel="stylesheet" />
    {{ end }}

  {{/* Open Graph image logic simplificado: cover > slug.jpg > illos > live.jpg */}}
  {{ $ogImage := "/images/covers/live.jpg" }}
  {{ if .Params.cover }}
    {{ $ogImage = printf "/images/covers/%s.jpg" .Params.cover }}
  {{ else }}
    {{ $slug := .File.BaseFileName }}
    {{ $slugCover := printf "/images/covers/%s.jpg" $slug }}
    {{ if (fileExists (printf "static%s" $slugCover)) }}
      {{ $ogImage = $slugCover }}
    {{ else if and (in .File.Path "/content/illustrations/") (not .Params.cover) .Params.illos }}
      {{ $firstIllo := index .Params.illos 0 }}
      {{ if $firstIllo }}
        {{ $jpg := printf "/images/illos/%s.jpg" $firstIllo }}
        {{ $png := printf "/images/illos/%s.png" $firstIllo }}
        {{ if (fileExists (printf "static%s" $jpg)) }}
          {{ $ogImage = $jpg }}
        {{ else if (fileExists (printf "static%s" $png)) }}
          {{ $ogImage = $png }}
        {{ else }}
          {{ $ogImage = $jpg }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  <meta property="og:image" content="{{ $ogImage | absURL }}" />
  <meta property="og:description" content="{{ .Params.description }}" />


</head>
